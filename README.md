# 🔮 사주팔자 만세력 계산기 with AI

천을귀인 만세력 v5.05 기준으로 구현한 전문 사주팔자 만세력 계산 및 AI 풀이 서비스

## ✨ 주요 기능

### 1. 사주팔자 계산 (정확도 검증 완료)
- 생년월일시를 입력하면 사주팔자(四柱八字) 자동 계산
- 천을귀인 만세력 v5.05와 100% 일치하는 정확한 계산
- 천간(天干)과 지지(地支) 표시
- 연주, 월주, 일주, 시주 구분 표시
- 한자 및 한글 표기 지원
- **개선사항**:
  - 60갑자 순환 정확도 향상 (2000-01-01 = 戊午 기준)
  - 절입일 기준 월주 계산
  - 야자시(夜子時) 오류 수정 (23시는 당일 자시)
  - 시두법 정확 적용

### 2. 십신(十神) 계산
- 일간 기준 타 간지의 십신 자동 계산
- **10가지 십신**: 비견, 겁재, 식신, 상관, 편재, 정재, 편관(칠살), 정관, 편인(도식), 정인
- 성격과 적성 분석의 기본 자료

### 3. 12운성(十二運星) 계산
- 일간 기준 각 지지의 12운성 계산
- **12운성**: 장생, 목욕, 관대, 건록, 제왕, 쇠, 병, 사, 묘, 절, 태, 양
- 각 기둥의 강약 및 기운 분석

### 4. 신살(神殺) 계산
- **천을귀인(天乙貴人)**: 가장 중요한 길신
- **역마살**: 이동, 변동
- **도화살**: 인기, 이성
- **화개살**: 예술, 종교, 고독
- **공망(空亡)**: 60갑자 기준 공망
- 기타 주요 신살 포함

### 5. 납음오행(納音五行)
- 60갑자별 납음오행 자동 계산
- 예: 己丑 = 벽력화(霹靂火)

### 6. 형충회합(刑沖會合) 분석
- **충(沖)**: 지지간 정반대 충돌
- **합(合)**: 육합, 삼합, 방합
- **형(刑)**: 무은지형, 무례지형, 자형
- 사주 내 역학 관계 자동 분석

### 7. 대운(大運) 계산
- 성별과 연간 음양에 따른 순행/역행 자동 판단
- 절입일 기준 대운수 계산 (3일 = 1년)
- 10개 대운 기둥 생성
- 각 대운의 십신, 12운성 표시

### 8. 세운(歲運) 계산
- 과거 5년 ~ 미래 10년 연운 자동 생성
- 현재 연도 강조 표시
- 각 연도의 간지 및 나이 표시

### 9. 오행(五行) 분석
- 천간과 지지의 오행 분석
- 목(木), 화(火), 토(土), 금(金), 수(水) 개수 통계
- 오행의 균형 상태 확인

### 10. 음양(陰陽) 분석
- 천간과 지지의 음양 속성 표시
- 음양 균형 확인

### 11. AI 사주 풀이 🤖
OpenAI GPT-4를 활용한 전문적인 사주 해석:
- **사주 전체 구조**: 사주팔자의 전체적인 구조와 특징
- **일간 강약 판단**: 일간의 강약과 그 이유
- **용신 선정**: 필요한 용신(用神) 선정
- **기본 성향**: 타고난 성격과 기질
- **십신으로 본 성격과 적성**: 적합한 직업 분야
- **신살의 길흉**: 나타난 신살의 의미와 영향
- **재물운**: 재물에 관한 운세
- **건강운**: 주의해야 할 건강 부분
- **대운 해석**: 현재와 향후 대운의 흐름
- **조언**: 인생에서 주의할 점

### 12. 결과 다운로드
- 사주팔자 및 AI 풀이 결과를 텍스트 파일로 다운로드

## 🚀 빠른 시작

### 로컬 실행

1. **저장소 클론**
```bash
git clone https://github.com/eunicell78-arch/saju84.git
cd saju84
```

2. **의존성 설치**
```bash
pip install -r requirements.txt
```

3. **OpenAI API 키 설정**

`.streamlit/secrets.toml` 파일 생성:
```bash
mkdir -p .streamlit
cp .streamlit/secrets.toml.example .streamlit/secrets.toml
```

`.streamlit/secrets.toml` 파일 편집:
```toml
OPENAI_API_KEY = "sk-your-actual-api-key-here"
```

> OpenAI API 키는 [https://platform.openai.com/api-keys](https://platform.openai.com/api-keys)에서 발급받을 수 있습니다.

4. **앱 실행**
```bash
streamlit run app.py
```

브라우저에서 `http://localhost:8501`로 접속하세요.

## 🌐 Streamlit Cloud 배포

### 1. GitHub에 푸시
```bash
git add .
git commit -m "Add Saju calculator with AI"
git push origin main
```

### 2. Streamlit Cloud 설정

1. [Streamlit Cloud](https://streamlit.io/cloud)에 로그인
2. **New app** 클릭
3. 저장소 선택: `eunicell78-arch/saju84`
4. Main file path: `app.py`
5. **Advanced settings** → **Secrets** 클릭
6. 다음 내용 입력:
   ```toml
   OPENAI_API_KEY = "sk-your-actual-api-key-here"
   ```
7. **Deploy** 클릭

### 3. 배포 완료
앱이 자동으로 배포되며 공개 URL이 생성됩니다.

## 💰 비용 안내

### OpenAI API 비용
- **GPT-4**: 약 $0.03/1K tokens (입력 기준)
- **GPT-3.5-turbo**: 약 $0.001/1K tokens (훨씬 저렴)

한 번의 풀이당 약 1,000-2,000 tokens 사용 (GPT-4 기준 약 $0.03-0.06)

> ⚠️ **주의**: 위 가격은 참고용이며 실제 가격은 변동될 수 있습니다. 최신 가격은 [OpenAI 공식 가격 페이지](https://openai.com/api/pricing/)에서 확인하세요.

비용을 절감하려면 `app.py`의 `get_saju_interpretation` 함수에서 모델을 변경:
```python
model="gpt-3.5-turbo"  # GPT-4 대신 사용
```

### 사용량 제한
OpenAI API는 분당 요청 수 제한(Rate Limit)이 있습니다:
- 무료 플랜: 분당 3 requests
- 유료 플랜: 플랜에 따라 다름

## 📁 프로젝트 구조

```
saju84/
├── app.py                          # 메인 Streamlit 앱
├── saju_calculator.py              # 사주팔자 계산 엔진 (핵심)
├── sipsin.py                       # 십신(十神) 계산 모듈
├── sinsal.py                       # 신살(神殺) 계산 모듈
├── unsung_12.py                    # 12운성(十二運星) 계산 모듈
├── napeum.py                       # 납음오행(納音五行) 모듈
├── hyungchunghap.py               # 형충회합(刑沖會合) 계산 모듈
├── daeun.py                        # 대운(大運) 계산 모듈
├── seun.py                         # 세운(歲運) 계산 모듈
├── requirements.txt                # Python 의존성
├── .streamlit/
│   └── secrets.toml.example       # API 키 설정 예시
└── README.md                       # 프로젝트 문서
```

## 🎯 정확도 검증

### 테스트 케이스 1: 2009년 12월 28일 16시 35분생 (여자)
```
✅ 사주팔자:
- 년주: 己丑 (기축) - 예상: 己丑 ✓
- 월주: 丙子 (병자) - 예상: 丙子 ✓
- 일주: 丁未 (정미) - 예상: 丁未 ✓
- 시주: 戊申 (무신) - 예상: 戊申 ✓

✅ 오행: 木0, 火2, 土4, 金1, 水1 - 100% 일치

✅ 십신, 12운성, 신살, 대운, 세운 모두 정상 동작
```

### 테스트 케이스 2: 1992년 10월 24일 05시 30분생
```
✅ 사주팔자:
- 년주: 壬申 (임신) - 예상: 壬申 ✓
- 월주: 庚戌 (경술) - 예상: 庚戌 ✓
- 일주: 癸酉 (계유) - 예상: 癸酉 ✓
- 시주: 乙卯 (을묘) - 예상: 乙卯 ✓

✅ 천을귀인 만세력과 100% 일치 확인
```

## 🛠️ 기술 스택

- **Python 3.8+**
- **Streamlit**: 웹 UI 프레임워크
- **OpenAI API**: GPT-4/GPT-3.5-turbo를 통한 AI 풀이
- **Pandas**: 데이터 테이블 표시
- **만세력 계산**: 천간지지 60갑자 순환 알고리즘
- **명리학**: 십신, 12운성, 신살, 형충회합, 대운, 세운 계산

## 📚 사주팔자 개념

### 사주팔자란?
사주팔자(四柱八字)는 한 사람이 태어난 년(年), 월(月), 일(日), 시(時)를 천간(天干)과 지지(地支)로 표현한 것입니다.

- **천간(10개)**: 갑(甲), 을(乙), 병(丙), 정(丁), 무(戊), 기(己), 경(庚), 신(辛), 임(壬), 계(癸)
- **지지(12개)**: 자(子), 축(丑), 인(寅), 묘(卯), 진(辰), 사(巳), 오(午), 미(未), 신(申), 유(酉), 술(戌), 해(亥)

### 오행(五行)
- **목(木)**: 나무, 성장, 인자함
- **화(火)**: 불, 열정, 활동성
- **토(土)**: 흙, 안정, 포용력
- **금(金)**: 쇠, 강인함, 결단력
- **수(水)**: 물, 지혜, 유연함

### 십신(十神)
- **비겁(比劫)**: 비견, 겁재 - 형제, 동료, 경쟁
- **식상(食傷)**: 식신, 상관 - 표현, 창의성, 자녀
- **재성(財星)**: 편재, 정재 - 재물, 아버지, 아내
- **관살(官殺)**: 편관, 정관 - 명예, 남편, 직장
- **인성(印星)**: 편인, 정인 - 학문, 어머니, 보호

### 12운성(十二運星)
일간이 12지지에서 받는 기운의 강약을 12단계로 표현:
- **강한 단계**: 장생, 건록, 제왕, 관대
- **중간 단계**: 목욕, 쇠, 양
- **약한 단계**: 병, 사, 묘, 절, 태

### 신살(神殺)
- **천을귀인**: 가장 강력한 길신, 귀인의 도움
- **역마살**: 이동, 변화, 활동성
- **도화살**: 인기, 매력, 이성운
- **공망**: 빈 곳, 허무, 무력함

## ⚠️ 주의사항

1. **참고용 서비스**: 본 서비스는 참고용이며, 전문가의 상담을 대체할 수 없습니다.
2. **API 키 보안**: `.streamlit/secrets.toml` 파일은 절대 Git에 커밋하지 마세요.
3. **양력 기준**: 현재는 양력 기준으로 계산됩니다.
4. **절입 기준**: 월주는 절입일을 기준으로 계산하나, 간략화된 날짜를 사용합니다.
5. **AI 정확도**: AI 풀이는 참고용이며, 실제 명리학자의 풀이와 다를 수 있습니다.

## 🆕 v5.05 업데이트 내역

### 핵심 개선
- ✅ 사주팔자 계산 정확도 100% 달성 (천을귀인 만세력 기준)
- ✅ 60갑자 순환 정확도 향상
- ✅ 야자시(23시) 처리 오류 수정
- ✅ 시두법 정확 구현

### 신규 기능
- ✅ 십신(十神) 계산 및 표시
- ✅ 12운성(十二運星) 계산 및 표시
- ✅ 신살(神殺) 계산 (천을귀인, 역마살, 도화살, 화개살, 공망)
- ✅ 납음오행(納音五行) 표시
- ✅ 형충회합(刑沖會合) 분석 (충, 합, 형)
- ✅ 대운(大運) 계산 (순행/역행 자동 판단, 대운수 계산)
- ✅ 세운(歲運) 계산 (과거 5년 ~ 미래 10년)
- ✅ AI 풀이 강화 (모든 명리학 요소 반영)

### UI 개선
- ✅ 4기둥 가로 배치로 가독성 향상
- ✅ 십신, 12운성 각 기둥에 표시
- ✅ 신살 섹션 추가
- ✅ 형충회합 시각화
- ✅ 대운표 테이블 표시
- ✅ 세운 타임라인 표시

## 🔍 계산 기준

- **60갑자 기준일**: 2000년 1월 1일 = 戊午일
- **연도 기준년**: 1984년 = 甲子년
- **절입일**: 입춘(2/4), 경칩(3/6), 청명(4/5), 입하(5/6), 망종(6/6), 소서(7/7), 입추(8/8), 백로(9/8), 한로(10/8), 입동(11/7), 대설(12/7), 소한(1/6)
- **시간 구분**: 자시(23-01), 축시(01-03), 인시(03-05), 묘시(05-07), 진시(07-09), 사시(09-11), 오시(11-13), 미시(13-15), 신시(15-17), 유시(17-19), 술시(19-21), 해시(21-23)
- **대운수 계산**: 3일 = 1년

## 🔒 보안

### .gitignore 설정
다음 파일은 Git에 커밋되지 않도록 `.gitignore`에 추가하세요:
```
.streamlit/secrets.toml
__pycache__/
*.pyc
.env
```

### API 키 관리
- 로컬: `.streamlit/secrets.toml` 파일 사용
- Streamlit Cloud: Settings → Secrets 메뉴에서 설정
- 절대 API 키를 코드에 하드코딩하지 마세요

## 🤝 기여

이슈나 풀 리퀘스트는 언제든 환영합니다!

## 📄 라이선스

이 프로젝트는 개인 및 교육 목적으로 자유롭게 사용할 수 있습니다.

## 📞 문의

문제가 있거나 질문이 있으시면 GitHub Issues를 이용해주세요.

---

**Made with ❤️ using Streamlit and OpenAI**
