"""
12운성(十二運星) 계산 모듈
Twelve Life Phases Calculator Module
"""

# 12운성 이름
TWELVE_PHASES = ['장생', '목욕', '관대', '건록', '제왕', '쇠', '병', '사', '묘', '절', '태', '양']

# 지지 순서
BRANCHES = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥']

# 일간별 12운성 배치
# 각 천간이 12지지에서 받는 기운
TWELVE_UNSUNG_TABLE = {
    '甲': {  # 갑목
        '亥': '장생', '子': '목욕', '丑': '관대', '寅': '건록', '卯': '제왕', '辰': '쇠',
        '巳': '병', '午': '사', '未': '묘', '申': '절', '酉': '태', '戌': '양'
    },
    '乙': {  # 을목
        '午': '장생', '巳': '목욕', '辰': '관대', '卯': '건록', '寅': '제왕', '丑': '쇠',
        '子': '병', '亥': '사', '戌': '묘', '酉': '절', '申': '태', '未': '양'
    },
    '丙': {  # 병화
        '寅': '장생', '卯': '목욕', '辰': '관대', '巳': '건록', '午': '제왕', '未': '쇠',
        '申': '병', '酉': '사', '戌': '묘', '亥': '절', '子': '태', '丑': '양'
    },
    '丁': {  # 정화
        '酉': '장생', '申': '목욕', '未': '관대', '午': '건록', '巳': '제왕', '辰': '쇠',
        '卯': '병', '寅': '사', '丑': '묘', '子': '절', '亥': '태', '戌': '양'
    },
    '戊': {  # 무토 (병화와 동일)
        '寅': '장생', '卯': '목욕', '辰': '관대', '巳': '건록', '午': '제왕', '未': '쇠',
        '申': '병', '酉': '사', '戌': '묘', '亥': '절', '子': '태', '丑': '양'
    },
    '己': {  # 기토 (정화와 동일)
        '酉': '장생', '申': '목욕', '未': '관대', '午': '건록', '巳': '제왕', '辰': '쇠',
        '卯': '병', '寅': '사', '丑': '묘', '子': '절', '亥': '태', '戌': '양'
    },
    '庚': {  # 경금
        '巳': '장생', '午': '목욕', '未': '관대', '申': '건록', '酉': '제왕', '戌': '쇠',
        '亥': '병', '子': '사', '丑': '묘', '寅': '절', '卯': '태', '辰': '양'
    },
    '辛': {  # 신금
        '子': '장생', '亥': '목욕', '戌': '관대', '酉': '건록', '申': '제왕', '未': '쇠',
        '午': '병', '巳': '사', '辰': '묘', '卯': '절', '寅': '태', '丑': '양'
    },
    '壬': {  # 임수
        '申': '장생', '酉': '목욕', '戌': '관대', '亥': '건록', '子': '제왕', '丑': '쇠',
        '寅': '병', '卯': '사', '辰': '묘', '巳': '절', '午': '태', '未': '양'
    },
    '癸': {  # 계수
        '卯': '장생', '寅': '목욕', '丑': '관대', '子': '건록', '亥': '제왕', '戌': '쇠',
        '酉': '병', '申': '사', '未': '묘', '午': '절', '巳': '태', '辰': '양'
    }
}


def get_twelve_unsung(day_stem: str, branch: str) -> str:
    """
    12운성 계산
    
    일간이 특정 지지에서 받는 기운(운성)을 계산
    
    Args:
        day_stem: 일간 (한자, 예: '丁')
        branch: 지지 (한자, 예: '未')
    
    Returns:
        12운성 이름 (예: '관대', '건록' 등)
    """
    # 한자만 추출 (괄호 제거)
    if '(' in day_stem:
        day_stem = day_stem.split('(')[1].rstrip(')')
    if '(' in branch:
        branch = branch.split('(')[1].rstrip(')')
    
    unsung_dict = TWELVE_UNSUNG_TABLE.get(day_stem, {})
    return unsung_dict.get(branch, '미상')


def get_unsung_description(unsung: str) -> str:
    """
    12운성의 의미 설명
    
    Args:
        unsung: 12운성 이름
    
    Returns:
        12운성의 간단한 설명
    """
    descriptions = {
        '장생': '탄생, 시작, 생명력 왕성',
        '목욕': '세속적 욕망, 변화, 불안정',
        '관대': '성장, 사회진출, 활동력',
        '건록': '왕성한 활동, 자립, 성취',
        '제왕': '최고의 힘, 권력, 정점',
        '쇠': '쇠퇴의 시작, 은퇴 준비',
        '병': '병약함, 고난, 시련',
        '사': '죽음, 종말, 끝',
        '묘': '무덤, 저장, 축적',
        '절': '단절, 고독, 절멸',
        '태': '임신, 준비, 잠재력',
        '양': '양육, 교육, 성장 준비'
    }
    
    return descriptions.get(unsung, '')


def get_unsung_strength(unsung: str) -> str:
    """
    12운성의 강약 분류
    
    Args:
        unsung: 12운성 이름
    
    Returns:
        강약 분류 ('왕', '상', '중', '약', '사')
    """
    strength_map = {
        '제왕': '왕',
        '건록': '왕',
        '관대': '상',
        '장생': '상',
        '목욕': '중',
        '태': '중',
        '양': '중',
        '쇠': '약',
        '병': '약',
        '묘': '사',
        '절': '사',
        '사': '사'
    }
    
    return strength_map.get(unsung, '중')


if __name__ == '__main__':
    # 테스트: 2009-12-28생 일간 丁
    day_stem = '丁'
    
    test_cases = [
        ('丑', '년지'),  # 己丑
        ('子', '월지'),  # 丙子
        ('未', '일지'),  # 丁未
        ('申', '시지')   # 戊申
    ]
    
    print(f"일간: {day_stem}\n")
    print("12운성:")
    for branch, position in test_cases:
        unsung = get_twelve_unsung(day_stem, branch)
        desc = get_unsung_description(unsung)
        strength = get_unsung_strength(unsung)
        print(f"{position} {branch}: {unsung} (강약: {strength})")
        if desc:
            print(f"  → {desc}")
    
    # 모든 지지에 대한 12운성 출력
    print(f"\n일간 {day_stem}의 12운성 전체:")
    for branch in BRANCHES:
        unsung = get_twelve_unsung(day_stem, branch)
        print(f"{branch}: {unsung}", end='  ')
    print()
