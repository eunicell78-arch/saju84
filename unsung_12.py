"""
12운성(十二運星) 계산 모듈
Twelve Life Phases Calculation Module

일간이 12지지에서 받는 기운
12운성: 장생, 목욕, 관대, 건록, 제왕, 쇠, 병, 사, 묘, 절, 태, 양
"""

# 12운성 테이블 (일간별로 12지지에서의 운성)
TWELVE_UNSUNG = {
    '甲': {
        '亥': '장생', '子': '목욕', '丑': '관대', '寅': '건록', '卯': '제왕', '辰': '쇠',
        '巳': '병', '午': '사', '未': '묘', '申': '절', '酉': '태', '戌': '양'
    },
    '乙': {
        '午': '장생', '巳': '목욕', '辰': '관대', '卯': '건록', '寅': '제왕', '丑': '쇠',
        '子': '병', '亥': '사', '戌': '묘', '酉': '절', '申': '태', '未': '양'
    },
    '丙': {
        '寅': '장생', '卯': '목욕', '辰': '관대', '巳': '건록', '午': '제왕', '未': '쇠',
        '申': '병', '酉': '사', '戌': '묘', '亥': '절', '子': '태', '丑': '양'
    },
    '丁': {
        '酉': '장생', '申': '목욕', '未': '관대', '午': '건록', '巳': '제왕', '辰': '쇠',
        '卯': '병', '寅': '사', '丑': '묘', '子': '절', '亥': '태', '戌': '양'
    },
    '戊': {
        '寅': '장생', '卯': '목욕', '辰': '관대', '巳': '건록', '午': '제왕', '未': '쇠',
        '申': '병', '酉': '사', '戌': '묘', '亥': '절', '子': '태', '丑': '양'
    },
    '己': {
        '酉': '장생', '申': '목욕', '未': '관대', '午': '건록', '巳': '제왕', '辰': '쇠',
        '卯': '병', '寅': '사', '丑': '묘', '子': '절', '亥': '태', '戌': '양'
    },
    '庚': {
        '巳': '장생', '午': '목욕', '未': '관대', '申': '건록', '酉': '제왕', '戌': '쇠',
        '亥': '병', '子': '사', '丑': '묘', '寅': '절', '卯': '태', '辰': '양'
    },
    '辛': {
        '子': '장생', '亥': '목욕', '戌': '관대', '酉': '건록', '申': '제왕', '未': '쇠',
        '午': '병', '巳': '사', '辰': '묘', '卯': '절', '寅': '태', '丑': '양'
    },
    '壬': {
        '申': '장생', '酉': '목욕', '戌': '관대', '亥': '건록', '子': '제왕', '丑': '쇠',
        '寅': '병', '卯': '사', '辰': '묘', '巳': '절', '午': '태', '未': '양'
    },
    '癸': {
        '卯': '장생', '寅': '목욕', '丑': '관대', '子': '건록', '亥': '제왕', '戌': '쇠',
        '酉': '병', '申': '사', '未': '묘', '午': '절', '巳': '태', '辰': '양'
    }
}


def get_unsung(day_stem: str, branch: str) -> str:
    """
    12운성 계산
    
    Args:
        day_stem: 일간 한자 (예: '甲', '乙', etc.)
        branch: 지지 한자 (예: '子', '丑', etc.)
    
    Returns:
        12운성 이름 (예: '장생', '목욕', etc.)
    """
    # 괄호 제거
    if '(' in day_stem:
        day_stem = day_stem.split('(')[1].replace(')', '')
    if '(' in branch:
        branch = branch.split('(')[1].replace(')', '')
    
    if day_stem in TWELVE_UNSUNG and branch in TWELVE_UNSUNG[day_stem]:
        return TWELVE_UNSUNG[day_stem][branch]
    
    return '미상'


def get_all_unsung(day_stem: str, year_branch: str, month_branch: str, 
                   day_branch: str, hour_branch: str) -> dict:
    """
    사주 전체 12운성 계산
    
    Returns:
        {'year': '운성', 'month': '운성', 'day': '운성', 'hour': '운성'}
    """
    return {
        'year': get_unsung(day_stem, year_branch),
        'month': get_unsung(day_stem, month_branch),
        'day': get_unsung(day_stem, day_branch),
        'hour': get_unsung(day_stem, hour_branch)
    }
